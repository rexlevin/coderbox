<link rel="stylesheet" href="../index.css">
<link rel="stylesheet" href="../../node_modules/bootstrap/dist/css/bootstrap.min.css">
<link rel="stylesheet" href="../../node_modules/bootstrap-icons/font/bootstrap-icons.css">
<div class="container-fluid" id="app">

    <div class="row pt-2">
        <div class="col">
            <div class="row">
                <div class="col">公钥：</div>
            </div>
            <div class="row">
                <div class="col">
                    <textarea class="form-control" v-model="publicKey" style="resize:none;color:grey" rows="10"></textarea>
                </div>
            </div>
        </div>
        <div class="col-2">
            <div class="row"><div class="col">&nbsp;</div></div>
            <div class="row">
                <div class="col">
                    <select class="form-select" v-model="keySize">
                        <option v-for="(key, index) in keySizeArray" :value="key.size">{{key.title}}</option>
                    </select>
                </div>
            </div>
            <div class="row mt-2">
                <div class="col text-center">
                    <button type="button" class="btn btn-secondary form-control text-nowrap" @click="generateKey">生成密钥</button>
                </div>
            </div>
        </div>
        <div class="col">
            <div class="row">
                <div class="col">私钥：</div>
            </div>
            <div class="row">
                <div class="col">
                    <textarea class="form-control" v-model="privateKey" style="resize:none;color:grey" rows="10"></textarea>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../../node_modules/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
<script src="../../node_modules/jsencrypt/bin/jsencrypt.min.js"></script>
<script src="../../node_modules/vue/dist/vue.global.prod.js"></script>
<script>
const app = {
    data() {
        return {
            keySizeArray: [
                { size: 512, title: '512 bit'},
                { size: 1024, title: '1024 bit'},
                { size: 2048, title: '2048 bit'},
                { size: 4096, title: '4096 bit'}
            ],
            keySize: 512,
            publicKey: '',
            privateKey: ''
        }
    },
    created() {
        document.addEventListener('keyup', (e) => {
            if (e.ctrlKey && e.shiftKey && (e.key == 'I' || e.key ==  'i')) {
                parent.devTools();
            }
            if (e.ctrlKey && (e.key == 'r' || e.key == 'R')) {
                parent.refresh();
            }
        });
    },
    methods: {
        generateKey() {
            let cypher = new JSEncrypt({
                default_key_size: this.keySize
            });
            console.info(cypher.getPrivateKey())
            this.publicKey = cypher.getPublicKey();
            this.privateKey = cypher.getPrivateKey();
            // new Promise(function (resolve) {
            //     setTimeout(function () {
            //         resolve([crypt.getPrivateKey(), crypt.getPublicKey()]);
            //     }, 50);
            // }).then(function (e) {
            //     this.privateKey = e[0];
            //     this.publicKey = e[1];
            //     console.info(this.publicKey)
            // });
        }
    }
}
Vue.createApp(app).mount('#app');
</script>